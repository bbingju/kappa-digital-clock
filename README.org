#+TITLE: Kappa Digital Clock
#+OPTIONS: toc: nil

[[https://travis-ci.com/bbingju/kappa-digital-clock.svg?branch=master]]

#+CAPTION: PCB
#+NAME: fig:KDC-01
[[./doc/kappa-digital-clock-pcb.jpg]]

* 요구사항

  - GPS 모듈이 붙어 있을 경우, GPS와 시간을 동기화 해야한다.
  - 주변 밝기에 따라 LED 밝기를 3단계로 자동 조절되어야 한다.
  - 현재 온도가 표시 되어야 한다.
  - 음력이 표시되어야 한다.


* Hardware

** MCU - ATmega64A ([[http://ww1.microchip.com/downloads/en/DeviceDoc/atmel-8160-8-bit-avr-microcontroller-atmega64a-datasheet.pdf][datasheet]])

** RTC - [[https://www.nxp.com/products/peripherals-and-logic/signal-chain/real-time-clocks/rtcs-with-temperature-compensation/accurate-rtc-with-integrated-quartz-crystal-for-industrial-applications:PCF2129][PCF2129]] ([[https://www.nxp.com/docs/en/data-sheet/PCF2129.pdf][datasheet]])

** RAM Mapping 16*8 LED Controller Driver - HT16K33 ([[https://cdn-shop.adafruit.com/datasheets/ht16K33v110.pdf][datasheet]])

** GPS


* Software

  현재까지 Ubuntu 18.04 (bionic) 과 MacOS 에서 빌드해보았다.
  기본적인 빌드 환경은 환경마다 아래와 설치한다.

** On Ubuntu
   #+BEGIN_SRC sh
     # Install avr toolchain & arduino-mk.
     sudo apt install arduino-mk
   #+END_SRC

** On MacOS
   #+BEGIN_SRC sh
     # Install avr toolchain & arduino-mk.
     brew tap sudar/arduino-mk
     brew install arduino-mk
   #+END_SRC

** Build
   빌드할 소스 준비는 아래와 같이 한다.

   #+BEGIN_SRC sh
     git clone https://github.com/bbingju/kappa-digital-clock.git
     git submodule update --init --recursive
   #+END_SRC

   빌드와 펌웨어 업로드 =Makefile= 을 적당히 수정하고, ~make~, ~make upload~ 를 명령한다.

** Arduino Core
*** [[https://github.com/MCUdude/MegaCore][MCUdude/MegaCore]]

** Arduino Libraries
*** [[https://github.com/amirchev/VariableTimedAction][amirchev/VariableTimedAction]]
*** [[https://github.com/jonpearse/ht16k33-arduino][jonpearse/ht16k33-arduino]]
*** [[https://github.com/adafruit/Adafruit_GPS][adafruit/Adafruit_GPS]]


* See Also

  - [[https://www.sparkfun.com/datasheets/GPS/Modules/PMTK_Protocol.pdf][MTK NMEA Packet User Manual]]
  - [[http://aprs.gids.nl/nmea/][GPS - NMEA sentence information]]
  - [[https://cdn-learn.adafruit.com/downloads/pdf/adafruit-ultimate-gps.pdf][Adafruit Ultimate GPS]]
  - [[https://search.naver.com/search.naver?sm=tab_hty.top&where=nexearch&ie=utf8&query=%25EB%2584%25A4%25EC%259D%25B4%25EB%25B2%2584+%25EC%258B%259C%25EA%25B3%2584][네이버 시계]]
